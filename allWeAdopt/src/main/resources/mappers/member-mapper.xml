<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

 	<resultMap type="member" id="member_rm">
	
		<id property="memberNo" column="MEMBER_NO"/>
		
		<result property="memberEmail" 		column="MEMBER_EMAIL"/>
		<result property="memberPw" 		column="MEMBER_PW"/>
		<result property="memberName" 	column="MEMBER_NM"/>
		<result property="memberTel" 		column="MEMBER_TEL"/>
		<result property="memberAddress" 	column="MEMBER_ADDR"/>
		<result property="profileImage" 	column="PROFILE_IMG"/>
		<result property="enrollDate" 		column="ENROLL_DT"/>
		<result property="memberType" 		column="MEMBER_TYPE"/>
		<result property="secessionFlag" 	column="SECESSION_FL"/>
	</resultMap>
   
 
 	<!-- 로그인 -->
  	<select id="login"  parameterType="member"  resultMap="member_rm"  >
 		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NM ,MEMBER_TEL,
       		MEMBER_ADDR, PROFILE_IMG, 
    		TO_CHAR( ENROLL_DT, 'YYYY-MM-DD HH24:MI:SS') AS ENROLL_DT, MEMBER_PW, MEMBER_TYPE
		FROM MEMBER
		WHERE MEMBER_EMAIL = #{memberEmail}
		AND SECESSION_FL = 'N' 
  	</select>
 

	<!-- 이메일 중복검사 -->
	<select id="emailDupCheck" resultMap="member_rm">
	SELECT MEMBER_TYPE FROM MEMBER
	WHERE MEMBER_EMAIL = #{memberEmail}
	AND SECESSION_FL = 'N'
	</select>
	
	<!-- 회원가입 -->
	<insert id="signUp">
	INSERT INTO MEMBER 
	VALUES(SEQ_MEMBER_NO.NEXTVAL,#{memberEmail},#{member.memberPw},#{memberName},#{memberTel},
		  #{member.memberAddress},#{profileImage},DEFAULT,DEFAULT,DEFAULT)
	</insert>



	<!-- 카카오 아이디(이메일) 일치하는 회원 정보를 조회하는 Service 호출 후 결과 반환 받기  -->
	<select id="kakaoEmailCheck"  parameterType="string"  resultMap="member_rm"  >
 		SELECT * FROM MEMBER
		WHERE MEMBER_EMAIL = #{kakaoEmail}
		AND SECESSION_FL = 'N' 
  	</select>
  	


	
 	<!--카카오 로그인시 회원번호 삽 -->
	<insert id="insertNo"  parameterType="member" useGeneratedKeys="true">
	 <selectKey keyProperty="memberNo" resultType="_int" order="BEFORE">
      	SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
   	</selectKey>
   	
		INSERT INTO MEMBER 
		VALUES(#{memberNo}, #{memberEmail}, NULL, #{memberName}, NULL,
				DEFAULT,DEFAULT,DEFAULT,'K',DEFAULT)
	</insert>
 	
 	<!-- 채팅대상 회원 정보 조회를 위한 sql -->
 	<select id="selectThisMember" resultMap="member_rm">
	SELECT DISTINCT MEMBER_NO,MEMBER_EMAIL,MEMBER_NM
	FROM BOARD
	JOIN MEMBER USING(MEMBER_NO)
	WHERE MEMBER_NO=#{memberNo}
 	</select>
 
 
</mapper>
