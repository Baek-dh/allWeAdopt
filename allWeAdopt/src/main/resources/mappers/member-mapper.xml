<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

 	<resultMap type="member" id="member_rm">
	
		<id property="memberNo" column="MEMBER_NO"/>
		
		<result property="memberEmail" 		column="MEMBER_EMAIL"/>
		<result property="memberPw" 		column="MEMBER_PW"/>
		<result property="memberName" 	column="MEMBER_NM"/>
		<result property="memberTel" 		column="MEMBER_TEL"/>
		<result property="memberAddress" 	column="MEMBER_ADDR"/>
		<result property="profileImage" 	column="PROFILE_IMG"/>
		<result property="enrollDate" 		column="ENROLL_DT"/>
		<result property="memberType" 		column="MEMBER_TYPE"/>
		<result property="secessionFlag" 	column="SECESSION_FL"/>
	</resultMap>
   
 
 	<!-- 로그인 -->
  	<select id="login"  parameterType="member"  resultMap="member_rm"  >
 		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NM ,MEMBER_TEL,
       		MEMBER_ADDR, PROFILE_IMG, 
    		TO_CHAR( ENROLL_DT, 'YYYY-MM-DD HH24:MI:SS') AS ENROLL_DT, MEMBER_PW, MEMBER_TYPE
		FROM MEMBER
		WHERE MEMBER_EMAIL = #{memberEmail}
		AND SECESSION_FL = 'N' 
  	</select>
 

	<!-- 이메일 중복검사 -->
	<select id="emailDupCheck" resultType="_int">
	SELECT COUNT(*) FROM MEMBER
	WHERE MEMBER_EMAIL = #{memberEmail}
	AND SECESSION_FL = 'N'
	</select>
	
	<!-- 회원가입 -->
	<insert id="signUp">
	INSERT INTO MEMBER 
	VALUES(SEQ_MEMBER_NO.NEXTVAL,#{memberEmail},#{memberPw},#{memberName},#{memberTel},
		  #{member.memberAddress},#{profileImage},DEFAULT,DEFAULT,DEFAULT)
	</insert>


	<!-- 카카오로그인 회원정보 조회 -->
	<select id="kakaoLogin" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEMBER_EMAIL = #{kakaoEmail}
		AND SECESSION_FL = 'N'
	</select>
	
	
	<!-- 회원 테이블 삽입 진행 -->
	<insert id="insertMember">
		INSERT INTO MEMBER 
		VALUES(SEQ_MEMBER_NO.NEXTVAL, #{kakaoEmail}, #{nickName})
	</insert>
	
	
   <insert id="insertBoard" parameterType="detail" useGeneratedKeys="true">
  
	   <selectKey keyProperty="boardNo" resultType="_int" order="BEFORE">
	      SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
	   </selectKey>
	   <!-- selectKey수행 후 parameterType "detail"의 boardNo필드에 세팅됨. !!! 
	        detail은 얕은복사해온 BoardDetail객체이므로 추후 boardNo는 detail에서 꺼내쓰면됨!-->
	   INSERT INTO BOARD VALUES(
	      #{boardNo}, #{boardTitle}, #{boardContent},
	      DEFAULT, DEFAULT, DEFAULT, DEFAULT, #{memberNo}, #{boardCode}   
	   )   
   </insert>
	
 
</mapper>
